# PodsToSPMConverter – Advanced Guide

This repository vendors third‑party dependencies as Swift Packages into the `External/` folder and generates a single Swift package at the repository root (named `ExternalPackages`). It is designed to work entirely offline after the first run by converting remote binary targets to path‑based dependencies and by mirroring transitive package sources locally.

## Overview
- Converts remote `.binaryTarget(url: ...)` targets to local `path:` XCFrameworks.
- Mirrors transitive SwiftPM dependencies locally and rewrites manifests to path‑based `package(path:)` entries.
- Generates a single root package (`ExternalPackages`) that re‑exports modules you use, so your app can simply `import ExternalPackages`.
- Supports authenticated and anonymous binary hosts (GitHub Releases, Artifactory/JFrog, S3 redirects, etc.).
- Cleans vendored repositories by removing VCS/CI metadata: `.git`, `.github`, `.circleci`, `.gitignore`, `.swiftlint.yml`.

## Quick Start
1. Adjust the configuration in `external_packages.json` (names, versions, products).
2. Run vendoring:
   ```bash
   python3 external_packages_builder.py --force
   ```
3. In Xcode, open the root `Package.swift` (package name: `ExternalPackages`) and build.


### Cleanup Only
Run the cleanup routine without recloning or downloading. This removes VCS/CI metadata and any leftover binary archives from `External/` and refreshes the README matrix.

```bash
python3 external_packages_builder.py --cleanup-only
```


## Useful Flags
- `--force` – reprocesses packages even if they were previously completed.
- `--package Name[,Name2]` – process only specific packages (fast iterative workflow).
- `--include-unsupported` – include packages marked `spmSupported: false` in the config.

## Authentication & Hosts
Some hosts require specific headers or flows. The script auto‑detects many common cases and also honors optional per‑package `binaryHeaders` from the config.

- GitHub Releases API assets
  - Accepts `GITHUB_TOKEN`/`GH_TOKEN` env for rate‑limit friendly downloads.
  - Uses `Accept: application/octet-stream` for asset endpoints.
- Artifactory / JFrog
  - Anonymous downloads via the documented Download API:
    - `GET /artifactory/api/download/{repoKey}/{path}?useRedirect=true`
  - Storage API fallback to resolve `downloadUri` for direct download.
  - Env‑based authentication (optional):
    - `ARTIFACTORY_API_KEY` / `APPD_ARTIFACTORY_API_KEY`
    - `ARTIFACTORY_ACCESS_TOKEN` / `APPD_ARTIFACTORY_ACCESS_TOKEN`
    - `ARTIFACTORY_USER` + `ARTIFACTORY_PASSWORD` or `ARTIFACTORY_BASIC_AUTH`

## Caching & Clean Builds
- Xcode → File → Packages → Reset Package Caches.
- Product → Clean Build Folder.
- CLI:
  ```bash
  swift package reset && swift package resolve
  ```
- Delete `~/Library/Developer/Xcode/DerivedData/*/SourcePackages` if a stale artifact pops up.

## Troubleshooting Tips
- “No such module ‘X’” after converting binaries: reset caches so Xcode picks up the new path‑based manifest.
- Slow clones: the script uses shallow fetches, tag‑first lookups, LFS smudge disabled, and cleans `.git` metadata after finishing.
- Path vs product names: SwiftPM lets you depend on “products”, but you import “modules” (targets). The root package re‑exports the actual modules so `import ExternalPackages` works.

---

## Vendored Packages – Live Matrix
The table below is generated by the script after each run.

<!-- BEGIN VENDOR MATRIX -->
Last updated: `2025-08-29T09:59:55Z`

| Package | Version |
|---|---|
| abseil-cpp-swiftpm | 0.20200225.4 |
| AEPAnalytics | 4.0.0 |
| AEPAssurance | 4.1.1 |
| AEPCore | 4.2.4 |
| AEPEdge | 4.3.1 |
| AEPEdgeConsent | 4.0.0 |
| AEPEdgeIdentity | 4.0.0 |
| AEPRulesEngine | 4.0.0 |
| AEPTarget | 4.0.3 |
| Alamofire | 5.0.0 |
| AlamofireNetworkActivityLogger | 3.4.0 |
| AppDynamicsAgent | 2023.10.1 |
| BigInt | 5.2.0 |
| boringssl-swiftpm | 0.7.2 |
| collectionconcurrencykit | 0.2.0 |
| CryptoSwift | 1.4.1 |
| DeviceKit | 5.5.0 |
| DGCharts | 5.0.0 |
| Firebase | 8.9.1 |
| FloatingPanel | 2.8.1 |
| googleappmeasurement | 8.9.1 |
| GoogleDataTransport | 9.1.2 |
| GoogleMaps | 8.3.1 |
| GooglePlaces | 8.3.0 |
| googleutilities | 7.13.3 |
| grpc-swiftpm | 1.28.4 |
| gtm-session-fetcher | 1.7.2 |
| Insider | 1.4.1 |
| IOSSecuritySuite | 2.0.2 |
| iProov | 11.1.1 |
| IQKeyboardManagerSwift | 6.3.0 |
| ISPageControl | 0.1.0 |
| KeychainAccess | 3.2.1 |
| Kingfisher | 7.9.1 |
| leveldb | 1.22.5 |
| Lottie | 4.5.0 |
| Mantis | 2.8.0 |
| MEPSDK | 9.8.6 |
| MGSwipeTableCell | 1.6.14 |
| nanopb | 0.3.9.8 |
| Promises | 2.0.0 |
| RxDataSources | 5.0.0 |
| RxKeyboard | 2.0.0 |
| RxSwift | 6.6.0 |
| RxSwiftExt | 6.2.1 |
| SkeletonView | 1.30.1 |
| sourcekitten | 0.33.1 |
| SVProgressHUD | 2.3.1 |
| swift-argument-parser | 1.2.3 |
| swift-protobuf | 1.31.0 |
| swift-syntax | HEAD |
| SwiftLint | 0.50.1 |
| swiftytexttable | 0.9.0 |
| swxmlhash | 7.0.2 |
| TensorFlowLiteC | 2.14.0 |
| yams | 5.4.0 |
| ZIPFoundation | 0.9.19 |
<!-- END VENDOR MATRIX -->






---

## Configuration Notes
- To keep a package vendor‑only (vendored locally but not added to the aggregate target), set its `products` to an empty list in `external_packages.json`.
- For packages that need post‑clone tweaks (e.g., move files, bump platform), add a `postCloneCommands` array with shell snippets. Commands run inside the package directory.

## License
See individual package licenses in `External/<Package>/` and this repository’s license.
